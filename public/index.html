<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Intelligence System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        
        .header h1 { font-size: 2.2em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        
        .status { margin-top: 15px; font-size: 1em; }
        .status-dot { 
            display: inline-block; 
            width: 10px; 
            height: 10px; 
            border-radius: 50%; 
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        .status-ready { background: #4CAF50; }
        .status-loading { background: #ff9800; }
        .status-error { background: #f44336; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 0.95em;
        }
        
        .btn:hover { transform: translateY(-2px); }
        .btn:active { transform: translateY(0); }
        .btn:disabled { 
            opacity: 0.5; 
            cursor: not-allowed;
            transform: none;
        }
        
        .performance {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .perf-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .perf-item { text-align: center; }
        .perf-value { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .perf-label { font-size: 0.9em; opacity: 0.9; }
        
        .pairs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .pair-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4CAF50;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .pair-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .pair-card.SHORT { border-left-color: #f44336; }
        .pair-card.NEUTRAL { border-left-color: #ff9800; }
        .pair-card.INSUFFICIENT_DATA { border-left-color: #9e9e9e; }
        
        .pair-card.high-confidence {
            animation: cardPulse 2s infinite;
        }
        
        @keyframes cardPulse {
            0%, 100% { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
            50% { box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4); }
        }
        
        .pair-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .pair-symbol {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
        }
        
        .confidence {
            padding: 4px 12px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        .conf-high { background: #4CAF50; }
        .conf-medium { background: #ff9800; }
        .conf-low { background: #9e9e9e; }
        
        .price-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .metric {
            text-align: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .metric-value {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .metric-label {
            font-size: 0.8em;
            color: #666;
        }
        
        .signal-section {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #2196F3;
        }
        
        .signal-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .tech-indicators {
            background: rgba(33, 150, 243, 0.1);
            padding: 10px;
            border-radius: 4px;
            font-size: 0.85em;
            margin-top: 10px;
        }
        
        .tech-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        
        .update-info {
            font-size: 0.75em;
            color: #999;
            text-align: center;
            margin-top: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            overflow-y: auto;
        }
        
        .modal.active { display: block; }
        
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            position: relative;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }
        
        .modal-close:hover { color: #333; }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .detail-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .detail-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }
        
        .news-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .news-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
            cursor: pointer;
        }
        
        .news-item:hover { background: #f8f9fa; }
        .news-item:last-child { border-bottom: none; }
        
        .news-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .news-meta {
            font-size: 0.85em;
            color: #666;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .sentiment-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .sentiment-positive { background: #c8e6c9; color: #2e7d32; }
        .sentiment-negative { background: #ffcdd2; color: #c62828; }
        .sentiment-neutral { background: #fff9c4; color: #f57f17; }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .loading.active { display: block; }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .pairs-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; align-items: center; }
            .btn { width: 200px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Trading Intelligence System</h1>
            <p>AI-Powered Technical Analysis with Real Predictions</p>
            <div class="status">
                <span class="status-dot status-ready" id="status-dot"></span>
                <span id="status-text">Connecting to backend...</span>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="loadData()" id="refresh-btn">Refresh Analysis</button>
            <button class="btn" onclick="filterByConfidence(75)">High Confidence Only</button>
            <button class="btn" onclick="filterByType('crypto')">Crypto Only</button>
            <button class="btn" onclick="filterByType('forex')">Forex Only</button>
            <button class="btn" onclick="showAllPairs()">Show All</button>
        </div>

        <div id="error-container"></div>

        <div class="performance">
            <h3>System Performance</h3>
            <div class="perf-grid">
                <div class="perf-item">
                    <div class="perf-value" id="total-pairs">--</div>
                    <div class="perf-label">Total Pairs</div>
                </div>
                <div class="perf-item">
                    <div class="perf-value" id="high-conf">--</div>
                    <div class="perf-label">High Confidence</div>
                </div>
                <div class="perf-item">
                    <div class="perf-value" id="last-update">--</div>
                    <div class="perf-label">Last Update</div>
                </div>
                <div class="perf-item">
                    <div class="perf-value" id="crypto-count">--</div>
                    <div class="perf-label">Crypto Pairs</div>
                </div>
                <div class="perf-item">
                    <div class="perf-value" id="forex-count">--</div>
                    <div class="perf-label">Forex Pairs</div>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loading-text">Loading analysis...</p>
        </div>

        <div class="pairs-grid" id="pairs-grid"></div>

        <div class="news-section">
            <h3>Latest Market News</h3>
            <div id="news-container">
                <p style="text-align: center; color: #666; padding: 20px;">
                    Loading news...
                </p>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detail-modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Configuration - UPDATE THIS WITH YOUR VERCEL DEPLOYMENT URL
        const API_BASE_URL = 'https://analyst-rho.vercel.app';
        
        let allPairsData = [];
        let currentFilter = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setStatus('loading', 'Connecting to backend...');
            loadData();
        });

        function setStatus(type, text) {
            const dot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            dot.className = 'status-dot status-' + type;
            statusText.textContent = text;
        }

        function showLoading(show = true) {
            const loading = document.getElementById('loading');
            const btn = document.getElementById('refresh-btn');
            
            if (show) {
                loading.classList.add('active');
                btn.disabled = true;
            } else {
                loading.classList.remove('active');
                btn.disabled = false;
            }
        }

        function showError(message) {
            const container = document.getElementById('error-container');
            container.innerHTML = '<div class="error-message">' + message + '</div>';
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        async function loadData() {
            showLoading(true);
            setStatus('loading', 'Fetching analysis from server...');
            
            try {
                const response = await fetch(API_BASE_URL + '/api/get-analysis');
                
                if (!response.ok) {
                    throw new Error('Server returned ' + response.status);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                allPairsData = data.pairs || [];
                
                // Update stats
                updateStats(data.stats);
                
                // Display pairs
                displayPairs(allPairsData);
                
                // Load news (separate call)
                await loadNews();
                
                setStatus('ready', 'Data loaded successfully - ' + allPairsData.length + ' pairs');
                
            } catch (error) {
                console.error('Error loading data:', error);
                setStatus('error', 'Failed to load data: ' + error.message);
                showError('Could not connect to backend. Check API_BASE_URL in code.');
                
                document.getElementById('pairs-grid').innerHTML = 
                    '<div style="grid-column: 1/-1; text-align: center; padding: 40px;">' +
                    '<h3>Connection Error</h3>' +
                    '<p>Cannot reach backend server. Please verify:</p>' +
                    '<ul style="text-align: left; max-width: 400px; margin: 20px auto;">' +
                    '<li>API_BASE_URL is set correctly in code</li>' +
                    '<li>Vercel deployment is active</li>' +
                    '<li>MongoDB connection is configured</li>' +
                    '</ul>' +
                    '</div>';
            } finally {
                showLoading(false);
            }
        }

        function updateStats(stats) {
            if (!stats) return;
            
            document.getElementById('total-pairs').textContent = stats.total_pairs || 0;
            document.getElementById('high-conf').textContent = stats.high_confidence_signals || 0;
            document.getElementById('crypto-count').textContent = stats.crypto_pairs || 0;
            document.getElementById('forex-count').textContent = stats.forex_pairs || 0;
            
            if (stats.last_update) {
                const date = new Date(stats.last_update);
                document.getElementById('last-update').textContent = date.toLocaleTimeString();
            }
        }

        function displayPairs(pairs) {
            const grid = document.getElementById('pairs-grid');
            grid.innerHTML = '';
            
            if (!pairs || pairs.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px;">' +
                    '<p>No trading data available. Backend may be processing initial data.</p>' +
                    '</div>';
                return;
            }
            
            pairs.forEach(pair => {
                const card = createPairCard(pair);
                grid.appendChild(card);
            });
        }

        function createPairCard(data) {
            const card = document.createElement('div');
            
            const signal = data.signal || {};
            const direction = signal.direction || 'NEUTRAL';
            const confidence = signal.confidence || 0;
            const confClass = confidence >= 75 ? 'conf-high' : confidence >= 50 ? 'conf-medium' : 'conf-low';
            
            card.className = 'pair-card ' + direction + (confidence >= 75 ? ' high-confidence' : '');
            card.onclick = () => showDetailModal(data);
            
            const changeColor = data.change_24h >= 0 ? '#4CAF50' : '#f44336';
            const changeSign = data.change_24h >= 0 ? '+' : '';
            
            card.innerHTML = `
                <div class="pair-header">
                    <div class="pair-symbol">${data.symbol}</div>
                    <div class="confidence ${confClass}">${Math.round(confidence)}%</div>
                </div>
                
                <div class="price-section">
                    <div class="metric">
                        <div class="metric-value">${formatPrice(data.price)}</div>
                        <div class="metric-label">Current Price</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" style="color: ${changeColor}">
                            ${changeSign}${data.change_24h.toFixed(2)}%
                        </div>
                        <div class="metric-label">24h Change</div>
                    </div>
                </div>
                
                <div class="signal-section">
                    <div class="signal-row">
                        <span><strong>Signal:</strong> ${direction}</span>
                        <span><strong>R/R:</strong> ${signal.risk_reward || 'N/A'}</span>
                    </div>
                    <div class="signal-row">
                        <span>Entry: ${formatPrice(signal.entry)}</span>
                        <span>TP: ${formatPrice(signal.tp)}</span>
                    </div>
                    <div class="signal-row">
                        <span>SL: ${formatPrice(signal.sl)}</span>
                        <span>ATR: ${signal.atr ? signal.atr.toFixed(6) : 'N/A'}</span>
                    </div>
                    
                    ${data.technical ? renderTechIndicators(data.technical) : ''}
                    
                    <div class="update-info">
                        ${new Date(data.timestamp).toLocaleString()} • ${data.source || 'Unknown'}
                    </div>
                </div>
            `;
            
            return card;
        }

        function renderTechIndicators(tech) {
            if (!tech) return '';
            
            return `
                <div class="tech-indicators">
                    <div class="tech-row">
                        <span>RSI: ${tech.rsi ? tech.rsi.toFixed(1) : 'N/A'}</span>
                        <span>Trend: ${tech.trend || 'N/A'}</span>
                    </div>
                    <div class="tech-row">
                        <span>MACD: ${tech.macd ? tech.macd.trend : 'N/A'}</span>
                        <span>Volume: ${tech.volume ? tech.volume.status : 'N/A'}</span>
                    </div>
                </div>
            `;
        }

        function formatPrice(price) {
            if (!price) return '0.00';
            
            if (price < 0.01) {
                return price.toFixed(6);
            } else if (price < 1) {
                return price.toFixed(4);
            } else if (price < 100) {
                return price.toFixed(2);
            } else {
                return price.toFixed(0);
            }
        }

        function showDetailModal(data) {
            const modal = document.getElementById('detail-modal');
            const body = document.getElementById('modal-body');
            
            const signal = data.signal || {};
            const tech = data.technical || {};
            
            body.innerHTML = `
                <h2>${data.symbol} - Detailed Analysis</h2>
                
                <div class="detail-grid">
                    <div class="detail-item">
                        <div class="detail-label">Signal Direction</div>
                        <div class="detail-value">${signal.direction || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Confidence</div>
                        <div class="detail-value">${signal.confidence ? signal.confidence.toFixed(1) + '%' : 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Current Price</div>
                        <div class="detail-value">${formatPrice(data.price)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">24h Change</div>
                        <div class="detail-value" style="color: ${data.change_24h >= 0 ? '#4CAF50' : '#f44336'}">
                            ${data.change_24h >= 0 ? '+' : ''}${data.change_24h.toFixed(2)}%
                        </div>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;">Trading Levels</h3>
                <div class="detail-grid">
                    <div class="detail-item">
                        <div class="detail-label">Entry Price</div>
                        <div class="detail-value">${formatPrice(signal.entry)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Take Profit</div>
                        <div class="detail-value" style="color: #4CAF50">${formatPrice(signal.tp)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Stop Loss</div>
                        <div class="detail-value" style="color: #f44336">${formatPrice(signal.sl)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Risk/Reward</div>
                        <div class="detail-value">${signal.risk_reward || 'N/A'}</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;">Technical Indicators</h3>
                <div class="detail-grid">
                    <div class="detail-item">
                        <div class="detail-label">RSI</div>
                        <div class="detail-value">${tech.rsi ? tech.rsi.toFixed(2) : 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">MACD Trend</div>
                        <div class="detail-value">${tech.macd ? tech.macd.trend : 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Trend</div>
                        <div class="detail-value">${tech.trend || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">ATR (Volatility)</div>
                        <div class="detail-value">${tech.atr ? tech.atr.toFixed(6) : 'N/A'}</div>
                    </div>
                </div>
                
                ${tech.support_resistance ? `
                    <h3 style="margin-top: 30px;">Support & Resistance</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Support Level</div>
                            <div class="detail-value">${formatPrice(tech.support_resistance.support)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Resistance Level</div>
                            <div class="detail-value">${formatPrice(tech.support_resistance.resistance)}</div>
                        </div>
                    </div>
                ` : ''}
                
                ${tech.bollinger_bands ? `
                    <h3 style="margin-top: 30px;">Bollinger Bands</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Upper Band</div>
                            <div class="detail-value">${formatPrice(tech.bollinger_bands.upper)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Middle Band</div>
                            <div class="detail-value">${formatPrice(tech.bollinger_bands.middle)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Lower Band</div>
                            <div class="detail-value">${formatPrice(tech.bollinger_bands.lower)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Position</div>
                            <div class="detail-value">${tech.bollinger_bands.position}</div>
                        </div>
                    </div>
                ` : ''}
            `;
            
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('detail-modal').classList.remove('active');
        }

        async function loadNews() {
            try {
                console.log('Fetching news from backend...');
                
                // First trigger news fetch
                const fetchResponse = await fetch(API_BASE_URL + '/api/fetch-news');
                const fetchData = await fetchResponse.json();
                console.log('News fetch result:', fetchData);
                
                // Wait a moment for database to update
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Now get all analysis data which should include news stats
                const response = await fetch(API_BASE_URL + '/api/get-analysis');
                const data = await response.json();
                
                const newsContainer = document.getElementById('news-container');
                
                // Check if we have news in the stats
                if (data.stats && data.stats.news_articles > 0) {
                    console.log(`Found ${data.stats.news_articles} news articles in database`);
                } else {
                    console.log('No news articles found in stats');
                }
                
                // Collect news from pairs (backend should attach recent news to each pair)
                let allNews = [];
                
                if (data.pairs && data.pairs.length > 0) {
                    data.pairs.forEach(pair => {
                        if (pair.news && Array.isArray(pair.news) && pair.news.length > 0) {
                            console.log(`Pair ${pair.symbol} has ${pair.news.length} news items`);
                            allNews = allNews.concat(pair.news);
                        }
                    });
                }
                
                console.log(`Total news items collected: ${allNews.length}`);
                
                // If no news from pairs, the news might not be attached yet
                // This is normal - news is stored separately and needs to be fetched differently
                if (allNews.length === 0) {
                    // Check MongoDB directly via stats
                    if (fetchData.processed && fetchData.processed > 0) {
                        newsContainer.innerHTML = `
                            <p style="text-align: center; color: #666; padding: 20px;">
                                ${fetchData.processed} news articles were processed and saved to database.<br>
                                <small>News display is being implemented. Articles are stored and will appear shortly.</small>
                            </p>
                        `;
                    } else {
                        newsContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No recent news available. Click Refresh to fetch latest articles.</p>';
                    }
                    return;
                }
                
                // Remove duplicates by title
                const uniqueNews = Array.from(
                    new Map(allNews.map(item => [item.title, item])).values()
                );
                
                // Sort by date (newest first)
                uniqueNews.sort((a, b) => {
                    const dateA = new Date(a.published_at);
                    const dateB = new Date(b.published_at);
                    return dateB - dateA;
                });
                
                console.log(`Displaying ${uniqueNews.length} unique news items`);
                
                // Clear container and display news
                newsContainer.innerHTML = '';
                
                // Show top 15 articles
                uniqueNews.slice(0, 15).forEach(article => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'news-item';
                    
                    const sentiment = article.sentiment || 0;
                    const sentimentClass = sentiment > 0.2 ? 'positive' : 
                                          sentiment < -0.2 ? 'negative' : 'neutral';
                    const sentimentText = sentiment > 0.2 ? 'Positive' : 
                                         sentiment < -0.2 ? 'Negative' : 'Neutral';
                    
                    const pairs = article.relevant_pairs ? article.relevant_pairs.join(', ') : 'General';
                    const publishedDate = new Date(article.published_at);
                    const timeAgo = getTimeAgo(publishedDate);
                    
                    newsItem.innerHTML = `
                        <div class="news-title">${article.title}</div>
                        <div class="news-meta">
                            <span class="sentiment-badge sentiment-${sentimentClass}">${sentimentText}</span>
                            <span>${article.source || 'Unknown'}</span>
                            <span>Pairs: ${pairs}</span>
                            <span>Impact: ${article.impact_score || 5}/10</span>
                            <span>${timeAgo}</span>
                        </div>
                    `;
                    
                    // Add click handler to open URL if available
                    if (article.url) {
                        newsItem.style.cursor = 'pointer';
                        newsItem.onclick = () => window.open(article.url, '_blank');
                    }
                    
                    newsContainer.appendChild(newsItem);
                });
                
            } catch (error) {
                console.error('Error loading news:', error);
                document.getElementById('news-container').innerHTML = 
                    '<p style="text-align: center; color: #999; padding: 20px;">Unable to load news at this time.</p>';
            }
        }
        
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' minutes ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
            if (seconds < 604800) return Math.floor(seconds / 86400) + ' days ago';
            
            return date.toLocaleDateString();
        }

        function filterByConfidence(minConf) {
            currentFilter = {type: 'confidence', value: minConf};
            const filtered = allPairsData.filter(p => (p.signal?.confidence || 0) >= minConf);
            displayPairs(filtered);
        }

        function filterByType(type) {
            currentFilter = {type: 'pair_type', value: type};
            const filtered = allPairsData.filter(p => p.type === type);
            displayPairs(filtered);
        }

        function showAllPairs() {
            currentFilter = null;
            displayPairs(allPairsData);
        }

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('detail-modal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
